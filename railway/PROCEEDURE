DELIMITER //

CREATE PROCEDURE InsertTrainSeats(
    IN p_booking_id INT,
    IN p_sch_id INT
)
BEGIN
    DECLARE next_seat_no INT;

    -- Find the next available seat number for the given sch_id
    SELECT MAX(seat_no) + 1 INTO next_seat_no
    FROM train_seats
    WHERE sch_id = p_sch_id;

    -- If there are no existing seat numbers, set next_seat_no to 1
    IF next_seat_no IS NULL THEN
        SET next_seat_no = 1;
    END IF;

    -- Insert the booking record with the allocated seat_no
    INSERT INTO train_seats (booking_id, sch_id, seat_no)
    VALUES (p_booking_id, p_sch_id, next_seat_no);
END //

DELIMITER ;